# ----------------------------------------------------------------------------------------------------
# Template to build the WebApp and create artifacts
# ----------------------------------------------------------------------------------------------------
parameters: 
- name: stageName
  default: 'CI'
- name: environment
  default: 'CI'
- name: buildConfiguration
  default: 'Release'
- name: rootDirectory
  default: '/services/Demo.WebUI'

# ----------------------------------------------------------------------------------------------------
jobs:
- deployment: BuildWebApp
  displayName: Build WebApp
  environment: ${{ parameters.environment }}
- job: BuildWebAppJob
  displayName: Build WebApp Job
  steps:
  - task: DotNetCoreCLI@2
    displayName: 'Build WebApp project'
    inputs:
      projects: ' ${{ parameters.rootDirectory }}/**/*.csproj'
      arguments: '--output publish_output --configuration Release'

  - task: DotNetCoreCLI@2
    displayName: 'Publish WebApp project'
    inputs:
      command: publish
      publishWebProjects: false
      projects: '${{ parameters.rootDirectory }}/**/*.csproj'
      arguments: '--configuration $(BuildConfiguration) --output $(build.artifactstagingdirectory)'
      
  - task: PublishPipelineArtifact@1
    displayName: 'Publish WebApp Artifacts'
    inputs:
      targetPath: '$(Build.ArtifactStagingDirectory)'
      artifact: 'App'
      publishLocation: 'pipeline'

  # - task: PublishPipelineArtifact@1
  #   displayName: 'Publish API Artifacts'
  #   inputs:
  #     targetPath: ' ${{ parameters.rootDirectory }}/Infrastructure'
  #     artifact: 'WebApp'
  #     publishLocation: 'pipeline'